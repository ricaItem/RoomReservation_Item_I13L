@page "/reservations"

<div class="reservations-container">
    <div class="reservations-header mb-4">
        <div>
            <h1 class="reservations-title">Reservation Management</h1>
            <p class="reservations-subtitle">Create, update, and manage room reservations</p>
        </div>
        <button class="btn-modern btn-primary-modern" @onclick="OpenAddModal">
            <i class="bi bi-plus-circle me-2"></i>
            Add Reservation
        </button>
    </div>

    <div class="reservations-card mb-4">
        <div class="reservations-card-body">
            <div class="row g-3 align-items-end">
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="bi bi-search me-2"></i>
                            Search
                        </label>
                        <div class="search-wrapper">
                            <i class="bi bi-search search-icon"></i>
                            <InputText class="form-control-modern search-input" @bind-Value="searchQuery" @oninput="FilterReservations" placeholder="Search by customer name, room..." />
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="bi bi-funnel me-2"></i>
                            Status
                        </label>
                        <InputSelect class="form-control-modern" @bind-Value="statusFilter" @onchange="FilterReservations">
                            <option value="">All Status</option>
                            <option value="Pending">Pending</option>
                            <option value="Confirmed">Confirmed</option>
                            <option value="Cancelled">Cancelled</option>
                            <option value="Completed">Completed</option>
                        </InputSelect>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="bi bi-calendar me-2"></i>
                            Start Date
                        </label>
                        <InputDate class="form-control-modern" @bind-Value="startDateFilter" @onchange="FilterReservations" />
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="bi bi-calendar me-2"></i>
                            End Date
                        </label>
                        <InputDate class="form-control-modern" @bind-Value="endDateFilter" @onchange="FilterReservations" />
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="bi bi-door-closed me-2"></i>
                            Room Type
                        </label>
                        <InputSelect class="form-control-modern" @bind-Value="roomTypeFilter" @onchange="FilterReservations">
                            <option value="">All Types</option>
                            <option value="Conference Room">Conference Room</option>
                            <option value="Meeting Room">Meeting Room</option>
                            <option value="Training Room">Training Room</option>
                            <option value="Event Hall">Event Hall</option>
                            <option value="Workspace">Workspace</option>
                            <option value="Lounge">Lounge</option>
                            <option value="Office">Office</option>
                        </InputSelect>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="bi bi-person me-2"></i>
                            Customer
                        </label>
                        <InputText class="form-control-modern" @bind-Value="customerFilter" @oninput="FilterReservations" placeholder="Customer name" />
                    </div>
                </div>
                <div class="col-md-2">
                    <button class="btn-modern btn-outline-modern w-100" type="button" @onclick="ClearFilters">
                        <i class="bi bi-arrow-counterclockwise me-2"></i>
                        Reset
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="reservations-card">
        <div class="reservations-card-header">
            <div class="d-flex justify-content-between align-items-center">
                <h3 class="reservations-card-title">
                    <i class="bi bi-list-ul me-2"></i>
                    Reservation List
                    <span class="badge-modern">@filteredReservationList.Count</span>
                </h3>
            </div>
        </div>
        <div class="reservations-card-body">
            @if (filteredReservationList.Count == 0)
            {
                <div class="empty-state">
                    <i class="bi bi-inbox"></i>
                    <h4>No reservations found</h4>
                    <p>@(reservationList.Count == 0 ? "Get started by adding your first reservation." : "Try adjusting your search or filter criteria.")</p>
                </div>
            }
            else
            {
                <div class="table-wrapper">
                    <table class="table-modern">
                        <thead>
                            <tr>
                                <th class="sortable" @onclick="@(() => SortBy("Id"))">
                                    Reservation ID
                                    @if (sortColumn == "Id")
                                    {
                                        <i class="bi bi-arrow-@(sortDirection == "asc" ? "up" : "down")"></i>
                                    }
                                </th>

                                <th class="sortable" @onclick="@(() => SortBy("CustomerName"))">
                                    Customer Name
                                    @if (sortColumn == "CustomerName")
                                    {
                                        <i class="bi bi-arrow-@(sortDirection == "asc" ? "up" : "down")"></i>
                                    }
                                </th>

                                <th class="sortable" @onclick="@(() => SortBy("RoomName"))">
                                    Room/Item Reserved
                                    @if (sortColumn == "RoomName")
                                    {
                                        <i class="bi bi-arrow-@(sortDirection == "asc" ? "up" : "down")"></i>
                                    }
                                </th>

                                <th class="sortable" @onclick="@(() => SortBy("CheckInDate"))">
                                    Check-in
                                    @if (sortColumn == "CheckInDate")
                                    {
                                        <i class="bi bi-arrow-@(sortDirection == "asc" ? "up" : "down")"></i>
                                    }
                                </th>

                                <th class="sortable" @onclick="@(() => SortBy("CheckOutDate"))">
                                    Check-out
                                    @if (sortColumn == "CheckOutDate")
                                    {
                                        <i class="bi bi-arrow-@(sortDirection == "asc" ? "up" : "down")"></i>
                                    }
                                </th>

                                <th class="sortable" @onclick="@(() => SortBy("Status"))">
                                    Status
                                    @if (sortColumn == "Status")
                                    {
                                        <i class="bi bi-arrow-@(sortDirection == "asc" ? "up" : "down")"></i>
                                    }
                                </th>

                                <th class="sortable" @onclick="@(() => SortBy("PaymentStatus"))">
                                    Payment Status
                                    @if (sortColumn == "PaymentStatus")
                                    {
                                        <i class="bi bi-arrow-@(sortDirection == "asc" ? "up" : "down")"></i>
                                    }
                                </th>

                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>

                        <tbody>
                            @foreach (var reservation in filteredReservationList)
                            {
                                <tr class="@GetStatusRowClass(reservation.Status)">
                                    <td><strong>#@reservation.Id</strong></td>
                                    <td>@reservation.CustomerName</td>
                                    <td>@reservation.RoomName</td>
                                    <td>@reservation.CheckInDate.ToString("MM/dd/yyyy")</td>
                                    <td>@reservation.CheckOutDate.ToString("MM/dd/yyyy")</td>
                                    <td>
                                        <span class="status-badge @GetStatusBadgeClass(reservation.Status)">
                                            <i class="bi bi-circle-fill me-1"></i>
                                            @reservation.Status
                                        </span>
                                    </td>
                                    <td>
                                        <span class="payment-badge @GetPaymentBadgeClass(reservation.PaymentStatus)">
                                            @reservation.PaymentStatus
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-action btn-view" @onclick="() => OpenViewModal(reservation)" title="View Details">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                            <button class="btn-action btn-edit" @onclick="() => OpenEditModal(reservation)" title="Edit">
                                                <i class="bi bi-pencil-square"></i>
                                            </button>
                                            @if (reservation.Status == "Pending")
                                            {
                                                <button class="btn-action btn-approve" @onclick="() => ApproveReservation(reservation)" title="Approve">
                                                    <i class="bi bi-check-circle"></i>
                                                </button>
                                            }
                                            @if (reservation.Status != "Cancelled" && reservation.Status != "Completed")
                                            {
                                                <button class="btn-action btn-cancel" @onclick="() => CancelReservation(reservation)" title="Cancel">
                                                    <i class="bi bi-x-circle"></i>
                                                </button>
                                            }
                                            <button class="btn-action btn-delete" @onclick="() => DeleteReservation(reservation)" title="Delete">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>

@if (showAddModal)
{
    <div class="modal-overlay" @onclick="CloseAddModal">
        <div class="modal-container" @onclick:stopPropagation="true">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="bi bi-plus-circle me-2"></i>
                    Add New Reservation
                </h3>
                <button class="modal-close" @onclick="CloseAddModal">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <EditForm Model="@reservationModel" OnValidSubmit="SaveReservation">
                    <DataAnnotationsValidator />
                    <ValidationSummary class="validation-summary" />

                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-door-closed me-2"></i>
                                    Room <span class="text-danger">*</span>
                                </label>
                                <InputSelect class="form-control-modern" @bind-Value="reservationModel.RoomName">
                                    <option value="">Select room</option>
                                    @foreach (var room in availableRooms)
                                    {
                                        <option value="@room">@room</option>
                                    }
                                </InputSelect>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-person me-2"></i>
                                    Customer Name <span class="text-danger">*</span>
                                </label>
                                <InputText class="form-control-modern" @bind-Value="reservationModel.CustomerName" placeholder="Enter customer name" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-telephone me-2"></i>
                                    Contact Number <span class="text-danger">*</span>
                                </label>
                                <InputText class="form-control-modern" @bind-Value="reservationModel.ContactNumber" placeholder="Enter contact number" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-envelope me-2"></i>
                                    Email
                                </label>
                                <InputText type="email" class="form-control-modern" @bind-Value="reservationModel.Email" placeholder="Enter email (optional)" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-calendar-check me-2"></i>
                                    Check-In Date <span class="text-danger">*</span>
                                </label>
                                <InputDate class="form-control-modern" @bind-Value="reservationModel.CheckInDate" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-calendar-x me-2"></i>
                                    Check-Out Date <span class="text-danger">*</span>
                                </label>
                                <InputDate class="form-control-modern" @bind-Value="reservationModel.CheckOutDate" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-circle-fill me-2"></i>
                                    Status <span class="text-danger">*</span>
                                </label>
                                <InputSelect class="form-control-modern" @bind-Value="reservationModel.Status">
                                    <option value="">Select status</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Confirmed">Confirmed</option>
                                    <option value="Cancelled">Cancelled</option>
                                    <option value="Completed">Completed</option>
                                </InputSelect>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-credit-card me-2"></i>
                                    Payment Status <span class="text-danger">*</span>
                                </label>
                                <InputSelect class="form-control-modern" @bind-Value="reservationModel.PaymentStatus">
                                    <option value="">Select payment status</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Paid">Paid</option>
                                    <option value="Partial">Partial</option>
                                    <option value="Refunded">Refunded</option>
                                </InputSelect>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions mt-4">
                        <button class="btn-modern btn-primary-modern" type="submit">
                            <i class="bi bi-plus-circle me-2"></i>
                            Add Reservation
                        </button>
                        <button class="btn-modern btn-secondary-modern" type="button" @onclick="CloseAddModal">
                            <i class="bi bi-x-circle me-2"></i>
                            Cancel
                        </button>
                    </div>
                </EditForm>
            </div>
        </div>
    </div>
}

@if (showEditModal)
{
    <div class="modal-overlay" @onclick="CloseEditModal">
        <div class="modal-container" @onclick:stopPropagation="true">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="bi bi-pencil-square me-2"></i>
                    Edit Reservation
                </h3>
                <button class="modal-close" @onclick="CloseEditModal">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <EditForm Model="@reservationModel" OnValidSubmit="UpdateReservation">
                    <DataAnnotationsValidator />
                    <ValidationSummary class="validation-summary" />

                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-hash me-2"></i>
                                    Reservation ID
                                </label>
                                <InputNumber class="form-control-modern" @bind-Value="reservationModel.Id" disabled />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-door-closed me-2"></i>
                                    Room <span class="text-danger">*</span>
                                </label>
                                <InputSelect class="form-control-modern" @bind-Value="reservationModel.RoomName">
                                    <option value="">Select room</option>
                                    @foreach (var room in availableRooms)
                                    {
                                        <option value="@room">@room</option>
                                    }
                                </InputSelect>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-person me-2"></i>
                                    Customer Name <span class="text-danger">*</span>
                                </label>
                                <InputText class="form-control-modern" @bind-Value="reservationModel.CustomerName" placeholder="Enter customer name" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-telephone me-2"></i>
                                    Contact Number <span class="text-danger">*</span>
                                </label>
                                <InputText class="form-control-modern" @bind-Value="reservationModel.ContactNumber" placeholder="Enter contact number" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-envelope me-2"></i>
                                    Email
                                </label>
                                <InputText type="email" class="form-control-modern" @bind-Value="reservationModel.Email" placeholder="Enter email (optional)" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-calendar-check me-2"></i>
                                    Check-In Date <span class="text-danger">*</span>
                                </label>
                                <InputDate class="form-control-modern" @bind-Value="reservationModel.CheckInDate" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-calendar-x me-2"></i>
                                    Check-Out Date <span class="text-danger">*</span>
                                </label>
                                <InputDate class="form-control-modern" @bind-Value="reservationModel.CheckOutDate" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-circle-fill me-2"></i>
                                    Status <span class="text-danger">*</span>
                                </label>
                                <InputSelect class="form-control-modern" @bind-Value="reservationModel.Status">
                                    <option value="">Select status</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Confirmed">Confirmed</option>
                                    <option value="Cancelled">Cancelled</option>
                                    <option value="Completed">Completed</option>
                                </InputSelect>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-credit-card me-2"></i>
                                    Payment Status <span class="text-danger">*</span>
                                </label>
                                <InputSelect class="form-control-modern" @bind-Value="reservationModel.PaymentStatus">
                                    <option value="">Select payment status</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Paid">Paid</option>
                                    <option value="Partial">Partial</option>
                                    <option value="Refunded">Refunded</option>
                                </InputSelect>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions mt-4">
                        <button class="btn-modern btn-primary-modern" type="submit">
                            <i class="bi bi-check-circle me-2"></i>
                            Update Reservation
                        </button>
                        <button class="btn-modern btn-secondary-modern" type="button" @onclick="CloseEditModal">
                            <i class="bi bi-x-circle me-2"></i>
                            Cancel
                        </button>
                    </div>
                </EditForm>
            </div>
        </div>
    </div>
}

@if (showViewModal)
{
    <div class="modal-overlay" @onclick="CloseViewModal">
        <div class="modal-container modal-view" @onclick:stopPropagation="true">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="bi bi-eye me-2"></i>
                    Reservation Details
                </h3>
                <button class="modal-close" @onclick="CloseViewModal">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                @if (selectedReservation != null)
                {
                    <div class="detail-view">
                        <div class="detail-section">
                            <h4 class="detail-section-title">Reservation Information</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Reservation ID:</span>
                                    <span class="detail-value">#@selectedReservation.Id</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Room:</span>
                                    <span class="detail-value">@selectedReservation.RoomName</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Status:</span>
                                    <span class="detail-value">
                                        <span class="status-badge @GetStatusBadgeClass(selectedReservation.Status)">
                                            @selectedReservation.Status
                                        </span>
                                    </span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Payment Status:</span>
                                    <span class="detail-value">
                                        <span class="payment-badge @GetPaymentBadgeClass(selectedReservation.PaymentStatus)">
                                            @selectedReservation.PaymentStatus
                                        </span>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h4 class="detail-section-title">Customer Information</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Customer Name:</span>
                                    <span class="detail-value">@selectedReservation.CustomerName</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Contact Number:</span>
                                    <span class="detail-value">@selectedReservation.ContactNumber</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Email:</span>
                                    <span class="detail-value">@(string.IsNullOrEmpty(selectedReservation.Email) ? "N/A" : selectedReservation.Email)</span>
                                </div>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h4 class="detail-section-title">Reservation Dates</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Check-In Date:</span>
                                    <span class="detail-value">@selectedReservation.CheckInDate.ToString("MM/dd/yyyy")</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Check-Out Date:</span>
                                    <span class="detail-value">@selectedReservation.CheckOutDate.ToString("MM/dd/yyyy")</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Duration:</span>
                                    <span class="detail-value">@((selectedReservation.CheckOutDate - selectedReservation.CheckInDate).Days) days</span>
                                </div>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h4 class="detail-section-title">Timestamps</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Created At:</span>
                                    <span class="detail-value">@selectedReservation.CreatedAt.ToString("MM/dd/yyyy HH:mm")</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Updated At:</span>
                                    <span class="detail-value">@selectedReservation.UpdatedAt.ToString("MM/dd/yyyy HH:mm")</span>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="modal-footer">
                <button class="btn-modern btn-secondary-modern" @onclick="CloseViewModal">
                    <i class="bi bi-x-circle me-2"></i>
                    Close
                </button>
            </div>
        </div>
    </div>
}

@code {
    private ReservationModel reservationModel = new();
    private List<ReservationModel> reservationList = new();
    private List<ReservationModel> filteredReservationList = new();
    private List<string> availableRooms = new();
    private string searchQuery = string.Empty;
    private string statusFilter = string.Empty;
    private DateTime? startDateFilter;
    private DateTime? endDateFilter;
    private string roomTypeFilter = string.Empty;
    private string customerFilter = string.Empty;
    private bool showAddModal = false;
    private bool showEditModal = false;
    private bool showViewModal = false;
    private ReservationModel? selectedReservation;
    private string sortColumn = "Id";
    private string sortDirection = "asc";
    private int nextId = 1;

    protected override void OnInitialized()
    {
        availableRooms = new List<string>
        {
            "Conference Room A",
            "Conference Room B",
            "Meeting Room 101",
            "Meeting Room 102",
            "Training Room 1",
            "Training Room 2",
            "Event Hall",
            "Workspace Alpha",
            "Lounge Area"
        };
        filteredReservationList = reservationList;
    }

    private void OpenAddModal()
    {
        reservationModel = new ReservationModel
        {
            CheckInDate = DateTime.Today,
            CheckOutDate = DateTime.Today.AddDays(1),
            Status = "Pending",
            PaymentStatus = "Pending"
        };
        showAddModal = true;
    }

    private void CloseAddModal()
    {
        showAddModal = false;
        reservationModel = new ReservationModel();
    }

    private void OpenEditModal(ReservationModel reservation)
    {
        reservationModel = new ReservationModel
        {
            Id = reservation.Id,
            RoomName = reservation.RoomName,
            CustomerName = reservation.CustomerName,
            ContactNumber = reservation.ContactNumber,
            Email = reservation.Email,
            CheckInDate = reservation.CheckInDate,
            CheckOutDate = reservation.CheckOutDate,
            Status = reservation.Status,
            PaymentStatus = reservation.PaymentStatus,
            CreatedAt = reservation.CreatedAt,
            UpdatedAt = reservation.UpdatedAt
        };
        showEditModal = true;
    }

    private void CloseEditModal()
    {
        showEditModal = false;
        reservationModel = new ReservationModel();
    }

    private void OpenViewModal(ReservationModel reservation)
    {
        selectedReservation = reservation;
        showViewModal = true;
    }

    private void CloseViewModal()
    {
        showViewModal = false;
        selectedReservation = null;
    }

    private void SaveReservation()
    {
        reservationModel.Id = nextId++;
        reservationModel.CreatedAt = DateTime.Now;
        reservationModel.UpdatedAt = DateTime.Now;
        if (string.IsNullOrEmpty(reservationModel.Status))
        {
            reservationModel.Status = "Pending";
        }
        if (string.IsNullOrEmpty(reservationModel.PaymentStatus))
        {
            reservationModel.PaymentStatus = "Pending";
        }
        reservationList.Add(new ReservationModel
        {
            Id = reservationModel.Id,
            RoomName = reservationModel.RoomName,
            CustomerName = reservationModel.CustomerName,
            ContactNumber = reservationModel.ContactNumber,
            Email = reservationModel.Email,
            CheckInDate = reservationModel.CheckInDate,
            CheckOutDate = reservationModel.CheckOutDate,
            Status = reservationModel.Status,
            PaymentStatus = reservationModel.PaymentStatus,
            CreatedAt = reservationModel.CreatedAt,
            UpdatedAt = reservationModel.UpdatedAt
        });

        CloseAddModal();
        FilterReservations();
    }

    private void UpdateReservation()
    {
        var existing = reservationList.FirstOrDefault(r => r.Id == reservationModel.Id);
        if (existing != null)
        {
            existing.RoomName = reservationModel.RoomName;
            existing.CustomerName = reservationModel.CustomerName;
            existing.ContactNumber = reservationModel.ContactNumber;
            existing.Email = reservationModel.Email;
            existing.CheckInDate = reservationModel.CheckInDate;
            existing.CheckOutDate = reservationModel.CheckOutDate;
            existing.Status = reservationModel.Status;
            existing.PaymentStatus = reservationModel.PaymentStatus;
            existing.UpdatedAt = DateTime.Now;
        }

        CloseEditModal();
        FilterReservations();
    }

    private void ApproveReservation(ReservationModel reservation)
    {
        reservation.Status = "Confirmed";
        reservation.UpdatedAt = DateTime.Now;
        FilterReservations();
    }

    private void CancelReservation(ReservationModel reservation)
    {
        reservation.Status = "Cancelled";
        reservation.UpdatedAt = DateTime.Now;
        FilterReservations();
    }

    private void DeleteReservation(ReservationModel reservation)
    {
        reservationList.Remove(reservation);
        FilterReservations();
    }

    private void SortBy(string column)
    {
        if (sortColumn == column)
        {
            sortDirection = sortDirection == "asc" ? "desc" : "asc";
        }
        else
        {
            sortColumn = column;
            sortDirection = "asc";
        }

        ApplySorting();
    }

    private void ApplySorting()
    {
        filteredReservationList = sortColumn switch
        {
            "Id" => sortDirection == "asc" 
                ? filteredReservationList.OrderBy(r => r.Id).ToList()
                : filteredReservationList.OrderByDescending(r => r.Id).ToList(),
            "CustomerName" => sortDirection == "asc"
                ? filteredReservationList.OrderBy(r => r.CustomerName).ToList()
                : filteredReservationList.OrderByDescending(r => r.CustomerName).ToList(),
            "RoomName" => sortDirection == "asc"
                ? filteredReservationList.OrderBy(r => r.RoomName).ToList()
                : filteredReservationList.OrderByDescending(r => r.RoomName).ToList(),
            "CheckInDate" => sortDirection == "asc"
                ? filteredReservationList.OrderBy(r => r.CheckInDate).ToList()
                : filteredReservationList.OrderByDescending(r => r.CheckInDate).ToList(),
            "CheckOutDate" => sortDirection == "asc"
                ? filteredReservationList.OrderBy(r => r.CheckOutDate).ToList()
                : filteredReservationList.OrderByDescending(r => r.CheckOutDate).ToList(),
            "Status" => sortDirection == "asc"
                ? filteredReservationList.OrderBy(r => r.Status).ToList()
                : filteredReservationList.OrderByDescending(r => r.Status).ToList(),
            "PaymentStatus" => sortDirection == "asc"
                ? filteredReservationList.OrderBy(r => r.PaymentStatus).ToList()
                : filteredReservationList.OrderByDescending(r => r.PaymentStatus).ToList(),
            _ => filteredReservationList
        };
    }

    private void FilterReservations()
    {
        filteredReservationList = reservationList.Where(res =>
            (string.IsNullOrEmpty(searchQuery) ||
             res.CustomerName.Contains(searchQuery, StringComparison.OrdinalIgnoreCase) ||
             res.RoomName.Contains(searchQuery, StringComparison.OrdinalIgnoreCase) ||
             res.Status.Contains(searchQuery, StringComparison.OrdinalIgnoreCase)) &&
            (string.IsNullOrEmpty(statusFilter) || res.Status == statusFilter) &&
            (!startDateFilter.HasValue || res.CheckInDate >= startDateFilter.Value) &&
            (!endDateFilter.HasValue || res.CheckOutDate <= endDateFilter.Value) &&
            (string.IsNullOrEmpty(roomTypeFilter) || res.RoomName.Contains(roomTypeFilter, StringComparison.OrdinalIgnoreCase)) &&
            (string.IsNullOrEmpty(customerFilter) || res.CustomerName.Contains(customerFilter, StringComparison.OrdinalIgnoreCase))
        ).ToList();

        ApplySorting();
    }

    private void ClearFilters()
    {
        searchQuery = string.Empty;
        statusFilter = string.Empty;
        startDateFilter = null;
        endDateFilter = null;
        roomTypeFilter = string.Empty;
        customerFilter = string.Empty;
        FilterReservations();
    }

    private string GetStatusBadgeClass(string status)
    {
        return status switch
        {
            "Pending" => "status-pending",
            "Confirmed" => "status-confirmed",
            "Cancelled" => "status-cancelled",
            "Completed" => "status-completed",
            _ => ""
        };
    }

    private string GetPaymentBadgeClass(string paymentStatus)
    {
        return paymentStatus switch
        {
            "Pending" => "payment-pending",
            "Paid" => "payment-paid",
            "Partial" => "payment-partial",
            "Refunded" => "payment-refunded",
            _ => ""
        };
    }

    private string GetStatusRowClass(string status)
    {
        return status switch
        {
            "Pending" => "row-pending",
            "Confirmed" => "row-confirmed",
            "Cancelled" => "row-cancelled",
            "Completed" => "row-completed",
            _ => ""
        };
    }

    public class ReservationModel
    {
        public int Id { get; set; }
        public string RoomName { get; set; } = string.Empty;
        public string CustomerName { get; set; } = string.Empty;
        public string ContactNumber { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public DateTime CheckInDate { get; set; } = DateTime.Today;
        public DateTime CheckOutDate { get; set; } = DateTime.Today.AddDays(1);
        public string Status { get; set; } = "Pending";
        public string PaymentStatus { get; set; } = "Pending";
        public DateTime CreatedAt { get; set; } = DateTime.Now;
        public DateTime UpdatedAt { get; set; } = DateTime.Now;
    }
}

<style>
    .reservations-container {
        padding: 1rem 0;
    }

    .reservations-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    .reservations-title {
        font-size: 2rem;
        font-weight: 700;
        color: #111827;
        margin-bottom: 0.5rem;
        letter-spacing: -0.02em;
    }

    .reservations-subtitle {
        font-size: 1rem;
        color: #6b7280;
        margin: 0;
    }

    .reservations-card {
        background: #ffffff;
        border-radius: 16px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        overflow: hidden;
    }

    .reservations-card-header {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #f3f4f6;
        background: #fafafa;
    }

    .reservations-card-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #111827;
        margin: 0;
        display: flex;
        align-items: center;
    }

    .reservations-card-body {
        padding: 1.25rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
    }

    .form-control-modern {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        font-size: 0.9375rem;
        background: #ffffff;
        transition: all 0.2s ease;
        outline: none;
    }

    .form-control-modern:focus {
        border-color: #111827;
        box-shadow: 0 0 0 3px rgba(17, 24, 39, 0.1);
    }

    .form-control-modern:disabled {
        background: #f9fafb;
        color: #9ca3af;
        cursor: not-allowed;
    }

    .search-wrapper {
        position: relative;
    }

    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
        z-index: 1;
    }

    .search-input {
        padding-left: 2.75rem;
    }

    .form-actions {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .btn-modern {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 10px;
        font-size: 0.9375rem;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        outline: none;
    }

    .btn-primary-modern {
        background: #111827;
        color: #ffffff;
    }

    .btn-primary-modern:hover {
        background: #1f2937;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(17, 24, 39, 0.2);
    }

    .btn-secondary-modern {
        background: #f3f4f6;
        color: #374151;
        border: 2px solid #e5e7eb;
    }

    .btn-secondary-modern:hover {
        background: #e9ecef;
        border-color: #d1d5db;
    }

    .btn-outline-modern {
        background: #ffffff;
        color: #111827;
        border: 2px solid #111827;
    }

    .btn-outline-modern:hover {
        background: #111827;
        color: #ffffff;
    }

    .validation-summary {
        background: #fef2f2;
        border: 1px solid #fecaca;
        color: #dc2626;
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 1.5rem;
        font-size: 0.875rem;
        list-style: none;
    }

    .badge-modern {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        background: #e5e7eb;
        color: #374151;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-left: 0.5rem;
    }

    .table-wrapper {
        overflow-x: auto;
    }

    .table-modern {
        width: 100%;
        border-collapse: collapse;
    }

    .table-modern thead {
        background: #f9fafb;
    }

    .table-modern th {
        padding: 1rem;
        text-align: left;
        font-size: 0.875rem;
        font-weight: 600;
        color: #374151;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border-bottom: 2px solid #e5e7eb;
    }

    .table-modern th.sortable {
        cursor: pointer;
        user-select: none;
        transition: background-color 0.2s ease;
    }

    .table-modern th.sortable:hover {
        background: #f3f4f6;
    }

    .table-modern td {
        padding: 1rem;
        border-bottom: 1px solid #f3f4f6;
        font-size: 0.9375rem;
        color: #111827;
    }

    .table-modern tbody tr {
        transition: background-color 0.2s ease;
    }

    .table-modern tbody tr:hover {
        background: #f9fafb;
    }

    .row-pending {
        background: rgba(251, 191, 36, 0.05);
    }

    .row-pending:hover {
        background: rgba(251, 191, 36, 0.1);
    }

    .row-confirmed {
        background: rgba(16, 185, 129, 0.05);
    }

    .row-confirmed:hover {
        background: rgba(16, 185, 129, 0.1);
    }

    .row-cancelled {
        background: rgba(239, 68, 68, 0.05);
    }

    .row-cancelled:hover {
        background: rgba(239, 68, 68, 0.1);
    }

    .row-completed {
        background: rgba(59, 130, 246, 0.05);
    }

    .row-completed:hover {
        background: rgba(59, 130, 246, 0.1);
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.8125rem;
        font-weight: 500;
    }

    .status-pending {
        background: #fef3c7;
        color: #92400e;
    }

    .status-confirmed {
        background: #d1fae5;
        color: #065f46;
    }

    .status-cancelled {
        background: #fee2e2;
        color: #991b1b;
    }

    .status-completed {
        background: #dbeafe;
        color: #1e40af;
    }

    .payment-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.8125rem;
        font-weight: 500;
    }

    .payment-pending {
        background: #fef3c7;
        color: #92400e;
    }

    .payment-paid {
        background: #d1fae5;
        color: #065f46;
    }

    .payment-partial {
        background: #fef3c7;
        color: #92400e;
    }

    .payment-refunded {
        background: #fee2e2;
        color: #991b1b;
    }

    .action-buttons {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn-action {
        width: 36px;
        height: 36px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        font-size: 1rem;
    }

    .btn-view {
        background: #dbeafe;
        color: #1e40af;
    }

    .btn-view:hover {
        background: #bfdbfe;
        transform: translateY(-2px);
    }

    .btn-edit {
        background: #e0e7ff;
        color: #4338ca;
    }

    .btn-edit:hover {
        background: #c7d2fe;
        transform: translateY(-2px);
    }

    .btn-approve {
        background: #d1fae5;
        color: #065f46;
    }

    .btn-approve:hover {
        background: #a7f3d0;
        transform: translateY(-2px);
    }

    .btn-cancel {
        background: #fee2e2;
        color: #991b1b;
    }

    .btn-cancel:hover {
        background: #fecaca;
        transform: translateY(-2px);
    }

    .btn-delete {
        background: #fee2e2;
        color: #dc2626;
    }

    .btn-delete:hover {
        background: #fecaca;
        transform: translateY(-2px);
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #9ca3af;
    }

    .empty-state i {
        font-size: 4rem;
        margin-bottom: 1rem;
        display: block;
        opacity: 0.5;
    }

    .empty-state h4 {
        font-size: 1.25rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        margin: 0;
        font-size: 0.9375rem;
    }

    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 1rem;
        animation: fadeIn 0.2s ease;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .modal-container {
        background: #ffffff;
        border-radius: 16px;
        width: 100%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: slideUp 0.3s ease;
    }

    .modal-container.modal-view {
        max-width: 700px;
    }

    @@keyframes slideUp {
        from {
            transform: translateY(20px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .modal-header {
        padding: 1.5rem;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #fafafa;
        border-radius: 16px 16px 0 0;
    }

    .modal-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #111827;
        margin: 0;
        display: flex;
        align-items: center;
    }

    .modal-close {
        width: 36px;
        height: 36px;
        border: none;
        background: transparent;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6b7280;
        transition: all 0.2s ease;
    }

    .modal-close:hover {
        background: #f3f4f6;
        color: #111827;
    }

    .modal-body {
        padding: 1.5rem;
    }

    .modal-footer {
        padding: 1rem 1.5rem;
        border-top: 1px solid #e5e7eb;
        display: flex;
        justify-content: flex-end;
        background: #fafafa;
        border-radius: 0 0 16px 16px;
    }

    .detail-view {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .detail-section {
        padding: 1rem;
        background: #f9fafb;
        border-radius: 12px;
    }

    .detail-section-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #111827;
        margin-bottom: 1rem;
    }

    .detail-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .detail-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .detail-label {
        font-size: 0.875rem;
        font-weight: 600;
        color: #6b7280;
    }

    .detail-value {
        font-size: 0.9375rem;
        color: #111827;
    }

    @@media (max-width: 1200px) {
        .table-modern {
            font-size: 0.875rem;
        }

        .table-modern th,
        .table-modern td {
            padding: 0.75rem;
        }
    }

    @@media (max-width: 992px) {
        .reservations-container {
            padding: 1.5rem 0;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .table-modern {
            min-width: 1200px;
        }
    }

    @@media (max-width: 768px) {
        .reservations-title {
            font-size: 1.75rem;
        }

        .reservations-header {
            flex-direction: column;
            gap: 1rem;
        }

        .reservations-header .btn-modern {
            width: 100%;
        }

        .reservations-card-body {
            padding: 1rem;
        }

        .form-actions {
            flex-direction: column;
        }

        .btn-modern {
            width: 100%;
        }

        .modal-container {
            max-width: 100%;
            margin: 1rem;
        }

        .detail-grid {
            grid-template-columns: 1fr;
        }
    }

    @@media (max-width: 480px) {
        .reservations-container {
            padding: 1rem 0;
        }

        .reservations-title {
            font-size: 1.5rem;
        }

        .reservations-card-header,
        .reservations-card-body {
            padding: 1rem;
        }

        .modal-header,
        .modal-body {
            padding: 1rem;
        }
    }
</style>
